function [A_lon,B_lon,A_lat,B_lat] = compute_ss_model(filename,x_trim,u_trim)
% x_trim is the trimmed state,
% u_trim is the trimmed input
  
[A, B, C, D] = linmod(filename, x_trim, u_trim);

% v(5), p(10), r(12), phi(7), psi(9)
E_lat1 = [...
          0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0;...
          0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0;...
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1;...
          0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0;...
          0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0;...
          ];
     
% delta_a(2), delta_r(3)
E_lat2 = [...
          0, 1, 0, 0;...
          0, 0, 1, 0;...
          ];
      
% u(4), w(6), q(11), theta(8), h = -pd(3)
E_lon1 = [...
          0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0;...
          0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0;...
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0;...
          0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0;...
          0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0;...
          ];

% delta_e(1), delta_t(4)
E_lon2 = [...
          1, 0, 0, 0;...
          0, 0, 0, 1;...
          ];
      
      
A_lat = E_lat1 * A * E_lat1';
B_lat = E_lat1 * B * E_lat2';

A_lon = E_lon1 * A * E_lon1';
B_lon = E_lon1 * B * E_lon2';